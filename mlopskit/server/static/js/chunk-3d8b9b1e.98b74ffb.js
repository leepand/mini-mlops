(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d8b9b1e"],{"1fd6":function(e,t,a){"use strict";a("2e58")},"2e58":function(e,t,a){},6607:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticStyle:{"margin-left":"15px","margin-right":"15px"}},[a("el-divider"),a("el-descriptions",{staticClass:"margin-top",attrs:{title:"",column:3,size:e.size}},[a("template",{slot:"title"},[a("span",[e._v(e._s(e.expMetaData.abname))])]),a("template",{slot:"extra"},[a("router-link",{staticStyle:{"text-decoration":"none",color:"aliceblue"},attrs:{to:{name:"活动管理",params:{campaign_id:this.$route.params.campaign_id}}}},[a("el-button",{staticClass:"return-list"},[a("i",{staticClass:"el-icon-arrow-left",staticStyle:{"margin-right":"5px"}}),e._v("返回实验组")])],1)],1),a("el-descriptions-item",{attrs:{label:"活动名称"}},[e._v(e._s(e.expMetaData.camp_name))]),a("el-descriptions-item",{attrs:{label:"实验名称"}},[e._v(e._s(e.expMetaData.abname))]),a("el-descriptions-item",{attrs:{label:"实验类型"}},[a("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.expMetaData.app_type))])],1),e.is_archived?a("el-descriptions-item",{attrs:{label:"实验状态"}},[a("el-tag",{attrs:{type:"info",size:"small"}},[e._v("已废弃")])],1):e.is_paused?a("el-descriptions-item",{attrs:{label:"实验状态"}},[a("el-tag",{attrs:{type:"info",size:"small"}},[e._v("已暂停")])],1):a("el-descriptions-item",{attrs:{label:"实验状态"}},[a("el-tag",{attrs:{type:"success",size:"small"}},[e._v("进行中")])],1),a("el-descriptions-item",{attrs:{label:"实验动态描述"}},[e._v(e._s(e.expMetaData.ab_dynamic_description))]),a("el-descriptions-item",{attrs:{label:"创建于"}},[e._v(e._s(e.expMetaData.creation_date))])],2),a("el-collapse",{staticStyle:{"margin-bottom":"20px"},on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"实时实验数据统计",name:"1"}},[a("div",{staticStyle:{float:"right"}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},nativeOn:{click:function(t){return e.pauseExp(t)}}},[e._v(e._s(!1===e.is_paused?"暂停实验":"开始实验"))]),a("el-button",{style:{display:e.stopVisible},attrs:{type:"primary"},on:{click:e.stopExp}},[e._v("停止实验")]),a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleEdit("index",{description:"description"})}}},[e._v("编辑实验描述")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},nativeOn:{click:function(t){return e.resetWinner(t)}}},[a("div",[e._v("重选获胜组")])]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:e.resetExp}},[a("div",[e._v("重设实验")])]),a("el-select",{staticStyle:{"margin-left":"10px"},attrs:{placeholder:"请选择KPI指标"},model:{value:e.abkpi,callback:function(t){e.abkpi=t},expression:"abkpi"}},e._l(e.KPIs,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("br"),a("el-row",{staticClass:"topmargin",attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("div",{style:{height:"400px",width:"1000px"},attrs:{id:"myChart"}})])],1),a("p",{staticStyle:{"padding-left":"50px",color:"#999"}},[e._v("*注"),a("strong",[e._v(": ")]),e._v("天/月/年")]),a("el-row",[a("el-col",{attrs:{span:4}},[a("el-select",{staticStyle:{"padding-left":"50px","padding-bottom":"10px"},attrs:{placeholder:"请选择时间周期"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}},e._l(e.options,(function(e){return a("el-option",{key:e.period,attrs:{label:e.label,value:e.period}})})),1)],1)],1),a("div",{staticStyle:{"padding-left":"50px",width:"96%"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.tableData,"row-style":e.tableRowStyle}},[a("el-table-column",{attrs:{type:"index",label:"#",width:"100"}}),a("el-table-column",{attrs:{prop:"name",label:"实验用例名称","min-width":"20%",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"font-size":"16px"}},[e._v(e._s(t.row.name))]),e._v(" "),t.row.is_control?a("span",{staticClass:"abcontrol"},[e._v(e._s(!1===t.row.app_type?"":"控制组"))]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"data",label:"转化情况","min-width":"20%",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                      "+e._s(t.row.completed_count)+" / "+e._s(t.row.participant_count)+"\n                  ")]}}])}),a("el-table-column",{attrs:{prop:"conversion_rate",label:"转化率","min-width":"20%",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                      "+e._s(t.row.conversion_rate.toFixed(2))+" ± "+e._s(t.row.confidence_interval.toFixed(1))+"%\n                  ")]}}])}),a("el-table-column",{attrs:{prop:"confidence_level",label:"置信度","min-width":"25%",sortable:"","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return["N/A"===t.row.confidence_level?a("a",[e._v("—")]):a("a",[e._v(e._s(t.row.confidence_level))])]}}])}),a("el-table-column",{attrs:{label:"操作","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.is_winner?e._e():a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){return e.handleSetWinner(t.$index,t.row)}}},[e._v("use this")]),t.row.is_winner?a("span",{staticClass:"abwinner"},[e._v(e._s(t.row.is_winner===e.None?"":"Winner!"))]):e._e()]}}])})],1)],1),a("div",{staticStyle:{"margin-top":"5%"}})],1)],1),a("el-dialog",{staticStyle:{width:"75%",left:"12.5%"},attrs:{title:"编辑",visible:e.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.editFormVisible=t}}},[a("el-form",{ref:"editForm",attrs:{model:e.editForm,"label-width":"80px",rules:e.editFormRules}},[a("el-form-item",{attrs:{label:"实验描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.editForm.description,callback:function(t){e.$set(e.editForm,"description",t)},expression:"editForm.description"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1)],1)},i=[],n=(a("ac6a"),a("7f7f"),a("c5f6"),a("6b54"),a("313e")),o=a("4ec3"),r=a("1157"),l=a.n(r),c={data:function(){return{activeNames:["1"],expMetaData:{},filters:{name:""},tableData:[],listLoading:!1,time:"",elapsedTime:"",host:"",description:"",abkpi:"",KPIs:[],options:[{period:"day",label:"今天"},{period:"month",label:"近一个月"},{period:"year",label:"近一年"}],pass:"",fail:"",error:"",is_archived:!1,is_paused:!1,abChartName:[],abChartX:[],abChartY:[],stopVisible:"",editLoading:!1,editFormVisible:!1,editFormRules:{description:[{required:!1,message:"请输入描述",trigger:"blur"},{max:1024,message:"不能超过1024个字符",trigger:"blur"}]},editForm:{name:"",version:"",type:"",description:""}}},mounted:function(){this.getAbExpMeta(),this.getTestResult()},methods:{getAbExpMeta:function(){var e=this;l.a.ajax({type:"get",url:o["I"]+"/api/campaigns/get_abexp_metadata",async:!0,data:{ab_id:this.$route.params.ab_id,abkpi:e.abkpi.toString()},headers:{Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(t){"999999"===t.code?(e.expMetaData=t.data.data,console.log(e.expMetaData,"this.expMetaData")):e.$message.error({message:t.msg,center:!0})}})},back:function(){this.$router.go(-1)},stopExp:function(){var e=this,t=this;this.$confirm("确认提交操作吗？","提示",{type:"warning"}).then((function(){t.stopVisible="none";var a=JSON.stringify({campaign_id:Number(e.$route.params.campaign_id),ab_id:Number(e.$route.params.ab_id)});l.a.ajax({type:"post",url:o["I"]+"/api/abtesting/report/stop_exp",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){"999999"===e.code?t.$message({message:e.msg,center:!0,type:"success"}):t.$message.error({message:e.msg,center:!0}),t.getTestResult()}})})).catch((function(){}))},pauseExp:function(){var e=this,t=this;this.$confirm("确认提交操作吗？","提示",{type:"warning"}).then((function(){var a=JSON.stringify({campaign_id:Number(e.$route.params.campaign_id),ab_id:Number(e.$route.params.ab_id)});l.a.ajax({type:"post",url:o["I"]+"/api/abtesting/report/pause_exp",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){"999999"===e.code?t.$message({message:e.msg,center:!0,type:"success"}):t.$message.error({message:e.msg,center:!0}),t.getTestResult()}})})).catch((function(){}))},handleEdit:function(e,t){this.editFormVisible=!0;var a=this.description;this.editForm=Object.assign({},{description:a})},editSubmit:function(){var e=this,t=this;this.$confirm("确认提交描述吗？","提示",{type:"warning"}).then((function(){t.editLoading=!0;var a=JSON.stringify({campaign_id:Number(e.$route.params.campaign_id),ab_id:Number(e.$route.params.ab_id),abkpi:e.abkpi.toString(),description:t.editForm.description});console.log(a,"abnameabname"),l.a.ajax({type:"post",url:o["I"]+"/api/abtesting/report/edit_ab_desc",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){t.editLoading=!1,"999999"===e.code?t.$message({message:"修改实验描述成功",center:!0,type:"success"}):t.$message.error({message:e.msg,center:!0}),t.editFormVisible=!1,t.getTestResult()}})})).catch((function(){}))},resetExp:function(){var e=this,t=this;this.$confirm("确认重置实验吗？","提示",{type:"warning"}).then((function(){var a=JSON.stringify({campaign_id:Number(e.$route.params.campaign_id),ab_id:Number(e.$route.params.ab_id)});console.log(a,"abnameabname"),l.a.ajax({type:"post",url:o["I"]+"/api/abtesting/report/reset_exp",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){"999999"===e.code?t.$message({message:"重置成功",center:!0,type:"success"}):t.$message.error({message:e.msg,center:!0}),t.getTestResult()}})})).catch((function(){}))},resetWinner:function(){var e=this,t=this;this.$confirm("确认重置胜利组吗？","提示",{type:"warning"}).then((function(){var a=JSON.stringify({campaign_id:Number(e.$route.params.campaign_id),ab_id:Number(e.$route.params.ab_id)});console.log(a,"abnameabname"),l.a.ajax({type:"post",url:o["I"]+"/api/abtesting/report/resetWinner",async:!0,data:a,headers:{"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))},timeout:5e3,success:function(e){"999999"===e.code?t.$message({message:"重置成功",center:!0,type:"success"}):t.$message.error({message:e.msg,center:!0}),t.getTestResult()}})})).catch((function(){}))},handleSetWinner:function(e,t){var a=this;this.listLoading=!0;var s={campaign_id:this.$route.params.campaign_id,altname:t.name.toString(),ab_id:this.$route.params.ab_id,user_name:JSON.parse(sessionStorage.getItem("name"))};console.log(s,"setwinner");var i={"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))};t.is_winner?Object(o["h"])(i,s).then((function(e){var s=e.msg,i=e.code;a.listLoading=!1,"999999"===i?(a.$message({message:"取消胜出设置",center:!0,type:"success"}),t.is_winner=!t.is_winner,a.getTestResult()):a.$message.error({message:s,center:!0})})):Object(o["h"])(i,s).then((function(e){var s=e.msg,i=e.code;a.listLoading=!1,"999999"===i?(a.$message({message:"设置胜出模型",center:!0,type:"success"}),t.is_winner=!t.is_winner,a.getTestResult()):a.$message.error({message:s,center:!0})}))},getTestResult:function(){this.listLoading=!0;var e=this,t={campaign_id:this.$route.params.campaign_id,ab_id:this.$route.params.ab_id,abkpi:this.abkpi.toString(),time:this.time.toString()};console.log(t,"paramsparamsparamsparams");var a={"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))};Object(o["E"])(a,t).then((function(t){var a=t.msg,s=t.code,i=t.data;e.listLoading=!1,"999999"===s?(e.tableData=i.alternatives,e.description=i.description,e.is_archived=i.is_archived,e.is_paused=i.is_paused,e.KPIs=i.kpis,e.abChartY=[],i.alternatives[0].data.length>6?i.alternatives.forEach((function(t){e.abChartName.push(t.name);var a=[];e.abChartX=[];for(var s=t.data.length,i=s-7;i<s;i++){var n=0,o=[];o=t.data[i],e.abChartX.push(o.date),n=100*Number(o.conversions/o.participants).toFixed(5),isNaN(n)&&(n=0),a.push(n)}e.abChartY.push({name:t.name,type:"line",data:a})})):i.alternatives.forEach((function(t){e.abChartName.push(t.name);var a=[];e.abChartX=[],t.data.forEach((function(t){var s=0;e.abChartX.push(t.date),s=100*Number(t.conversions/t.participants).toFixed(5),isNaN(s)&&(s=0),a.push(s)})),e.abChartY.push({name:t.name,type:"line",data:a})})),console.log(i.alternatives,e.abChartY,"dd"),e.drawLine(),i.is_archived?e.stopVisible="none":e.stopVisible=""):e.$message.error({message:a,center:!0})}))},drawLine:function(){var e=n["a"](document.getElementById("myChart"));console.log("abchart");var t={title:{text:"Conversion Rate",left:"center",top:20,textStyle:{color:"#ccc"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:this.abChartName},xAxis:[{type:"category",data:this.abChartX,axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"转化率",scale:!0,axisLabel:{formatter:"{value} %"}}],series:this.abChartY};e.setOption(t)},singleTestDraw:function(){var e=n["a"](document.getElementById("singleTestChart")),t={title:{text:"比例图",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20},toolbox:{feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},series:[{type:"pie",radius:"50%",center:["50%","50%"],data:[{value:"90",name:"ERROR"},{value:"5",name:"FAIL"},{value:"5",name:"PASS"}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};e.setOption(t)},tableRowStyle:function(e){return"ERROR"===e.result||"FAIL"===e.result?"background-color: #DC143C;":"TimeOut"===e.result?"background-color: #FFE4C4;":void 0},filterHandler:function(e,t,a){return t.result===e},getTenTestTime:function(){var e=this,t={project_id:this.$route.params.project_id},a={"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))};Object(o["getTestTenTime"])(a,t).then((function(t){var a=t.msg,s=t.code,i=t.data;"999999"===s?(e.options=i,i.length&&(e.time=i[0].startTime,e.elapsedTime=i[0].elapsedTime,e.host=i[0].host,e.getTestResult())):e.$message.error({message:a,center:!0})}))},changeHost:function(){for(var e=0;e<this.options.length;e++)this.options[e]["startTime"]===this.time&&(this.host=this.options[e].host,this.elapsedTime=this.options[e].elapsedTime)},getLatelyTenTestResult:function(){var e=this,t={project_id:this.$route.params.project_id},a={"Content-Type":"application/json",Authorization:"Token "+JSON.parse(sessionStorage.getItem("token"))};Object(o["getTestTenResult"])(a,t).then((function(t){var a=t.msg,s=t.code,i=t.data;"999999"===s?(console.log(i),i.forEach((function(t){e.latelyTenPass.push(100*t.pass),e.latelyTenFail.push(100*t.fail),e.latelyTenError.push(100*t.error)}))):e.$message.error({message:a,center:!0})}))}},watch:{time:function(){this.getAbExpMeta(),this.getTestResult()},abkpi:function(){this.getAbExpMeta(),this.getTestResult()}}},p=c,m=(a("1fd6"),a("2877")),d=Object(m["a"])(p,s,i,!1,null,"78a3fdd7",null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-3d8b9b1e.98b74ffb.js.map